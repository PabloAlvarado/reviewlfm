\documentclass[a4paper,10pt]{article}
\usepackage{times}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage[ansinew]{inputenc}
\usepackage{bm}
\usepackage{float}
\usepackage{url}
\usepackage{algorithm}
\usepackage{algorithmic}
\usepackage{graphics}
\usepackage{subfigure}
\usepackage[numbers]{natbib}
\usepackage[small]{caption}
\usepackage{url}
\usepackage{mathrsfs}

\newcommand{\dif}{\textrm{d}}
\renewcommand{\refname}{\normalsize References}

\setlength{\parindent}{0in}

\textwidth 7.5 in
\oddsidemargin -0.6 in
\topmargin -1 in
\textheight 10.5 in
\footskip 0.35 in


\DeclareMathOperator{\erf}{erf}
\DeclareMathOperator{\erfc}{erfc}
\DeclareMathOperator{\real}{Re}
\DeclareMathOperator{\imag}{Im} \DeclareMathOperator{\tr}{tr}
\DeclareMathOperator{\cov}{cov} \DeclareMathOperator{\ex}{E}
\DeclareMathOperator{\bdiag}{blockdiag}
\DeclareMathOperator{\vecO}{vec} \DeclareMathOperator{\diag}{diag}
\DeclareMathOperator{\const}{const}
%opening
\title{Covariance function from a Poisson PDE}
\author{}
\date{}
\begin{document}

\maketitle

The two-dimensional Poisson equation in a rectangular Cartesian
coordinate sytem has the form

\begin{align}\label{eq:poisson:dif:linear}
\frac{\partial^2 v(x,y)}{\partial x^2} +  \frac{\partial^2 v(x,y)}{\partial y^2} = -\sum_{\forall i} s_{i}f_i(x,y)
\end{align}

\section{Solving the Poisson equation}

The exact solution for Eq. \eqref{eq:poisson:dif:linear} is subject to
particular boundary conditions. For a first boundary value
problem with domain 
$0\leq x\leq a$ , $0\leq y\leq b$, and conditions given by
\begin{align*}
v(x=0, y) &= f_1(y)\\
v(x=a,y) &= f_2(y) \\
v(x,y=0) &= f_3(x) \\
v(x,y=b) &= f_4(x)
\end{align*}
the solution to this equation is given by \cite{Polyanin:Handbook02}
\begin{align}\label{eq:sol:poisson:dif:linear}
\begin{split}
v(x,y)&=\sum_{\forall i}s_{i} \int_{0}^{a}\int_{0}^{b}f_i(\xi,\eta)G(x, y,\xi,\eta)\dif{\eta}\dif{\xi}\\
      &+ \int_0^bf_1(\eta)H_1(x, y, \eta)\dif\eta
      -\int_0^bf_2(\eta)H_2(x, y, \eta)\dif\eta \\
 &+ \int_0^af_3(\xi)H_3(x, y, \xi)\dif\xi -\int_0^af_4(\eta)H_4(x, y, \xi)\dif\xi,
\end{split}
\end{align}
where the Green function $G(x, y,\xi,\eta)$ and the functions $H_1(x,
y,\xi,\eta)$, $H_2(x, y,\xi,\eta)$, $H_3(x, y,\xi,\eta)$ and $H_4(x, y,\xi,\eta)$ are given by
\begin{align}\label{eq:green:function}
G(x, y,\xi,\eta)&=\frac{4}{ab}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty\frac{\sin\left({p_n x}\right)
\sin\left(q_m y\right)\sin\left(p_n \xi\right)\sin\left(q_m \eta\right)}{p_n^2 + q_m^2},\\
H_1(x, y,\eta)& =
                         \left.\frac{\partial}{\partial\xi}G(x, y, \xi,\eta)\right|_{\xi=0},\quad 
H_2(x, y,\eta) = \left.\frac{\partial}{\partial\xi}G(x, y,
                    \xi,\eta)\right|_{\xi=a}\nonumber,\\
H_3(x, y,\xi)& =
                         \left.\frac{\partial}{\partial\eta}G(x, y, \xi,\eta)\right|_{\eta=0},\quad 
H_4(x, y,\xi) = \left.\frac{\partial}{\partial\eta}G(x, y, \xi,\eta)\right|_{\eta=b}\nonumber,
\end{align}
where $p_n=\frac{n\pi}{a}$, and $q_m=\frac{m\pi}{b}$.

Assuming $f_1(y) = f_2(y)= f_3(x) = f_4(x) = 0$, equation \eqref{eq:sol:poisson:dif:linear} is equal to
\begin{align}
v(x,y)= \sum_{\forall i}s_{i} \int_{0}^{a}\int_{0}^{b}f_i(\xi,\eta)G(x, y,\xi,\eta)\dif{\eta}\dif{\xi}\label{eq:sol:poisson:dif:linear:init:hom}
\end{align}
where $G(x, y, \xi,\eta)$ is given by \eqref{eq:green:function}.

\subsection*{Boundary conditions}

We first compute the functions $H_1(x, y, \xi, \eta)$, $H_2(x, y, \xi, \eta)$,
$H_3(x, y, \xi, \eta)$, and $H_4(x, y, \xi, \eta)$,

\begin{align*}
  H_1(x, y,\eta)& =\left.\frac{\partial}{\partial\xi}G(x, y, \xi,\eta)\right|_{\xi=0}
  = \frac{4}{ab}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty \frac{p_n}{p_n^2 + q_m^2}\sin\left({p_n x}\right)
\sin\left(q_m y\right)\sin\left(q_m \eta\right)
\end{align*}

\begin{align*}
  H_2(x, y,\eta)& =\left.\frac{\partial}{\partial\xi}G(x, y, \xi,\eta)\right|_{\xi=a}
  = \frac{4}{ab}\sum_{n=1}^\infty
  \sum_{m=1}^\infty\frac{p_n\cos(n\pi)}{p_n^2 + q_m^2}
  \sin\left({p_n x}\right)\sin\left(q_m y\right)\sin\left(q_m \eta\right)
\end{align*}

\begin{align*}
  H_3(x, y,\xi)& =\left.\frac{\partial}{\partial\eta}G(x, y, \xi,\eta)\right|_{\eta=0}
  = \frac{4}{ab}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty \frac{q_m}{p_n^2 + q_m^2}\sin\left({p_n x}\right)
\sin\left(q_m y\right)\sin\left(p_n \xi\right)
\end{align*}

\begin{align*}
  H_4(x, y,\xi)& =\left.\frac{\partial}{\partial\eta}G(x, y, \xi,\eta)\right|_{\eta=b}
  = \frac{4}{ab}\sum_{n=1}^\infty
  \sum_{m=1}^\infty\frac{q_m\cos(m\pi)}{p_n^2 + q_m^2}
  \sin\left({p_n x}\right)\sin\left(q_m y\right)\sin\left(p_n \xi\right)
\end{align*}



\section{Covariance matrix bewteen the outputs}

We assume that $f_i(x,y)$ are independent Gaussian processes with
mean value equal to zero and covariance matrix equal to
$K_i(x,x',y,y')=K_i(x,x')K_i(y,y')$. Since the PDE equation is
linear, the $v_q(x,y)$ are Gaussian processes with covariance matrix
given by
\begin{align}
\cov\left[v_q(x,y),v_s(x',y')\right]=\ex\left[\sum_{\forall
i}s_{qi}\int_0^a\int_0^bf_i(\xi,\eta)G(x,y, \xi,\eta)\dif\xi\dif\eta\right.\\
\left.\sum_{\forall
k}s_{sk}\int_0^{a}\int_0^bf_k(\xi',\eta')G(x',y', \xi',\eta')\dif\xi'\dif\eta'\right]
\end{align}
Then, the covariance $\cov\left[v_q(x,y),v_s(x',y')\right]$ is given
as
\begin{align}\notag
\sum_{\forall i}s_{qi}\sum_{\forall
k}s_{sk}\int_0^a\int_0^{a}\int_0^b\int_0^bG(x,y, \xi,\eta)G(x',y',\xi',\eta')\ex\left[f_i(\xi,\eta)f_k(\xi',\eta')\right]
\dif\xi'\dif\xi\dif\eta'\dif\eta
\end{align}
With
$\ex\left[f_i(\xi,\eta)f_k(\xi',\eta')\right]=K_{ik}(\xi,\xi',\eta,\eta')\delta_{ik}=K_{ik}(\xi,\xi')K_{ik}(\eta,\eta')\delta_{ik}$,
the last expression can be written as
\begin{align}\notag
\sum_{\forall
i}s_{qi}s_{si}\int_0^a\int_0^{a}\int_0^b\int_0^bG(x,y, \xi,\eta)G(x',
  y, \xi',\eta')K_i(\xi,\xi')K_i(\eta,\eta')
\dif\xi'\dif\xi\dif\eta'\dif\eta
\end{align}
Using the expression \eqref{eq:green:function} for $G(x,y, \xi,\eta)$ and SE kernels for the
covariances of the latent processes, we have
\begin{align}\notag
\sum_{\forall
i}s_{qi}s_{si}\int_0^a\int_0^{a}\int_0^b\int_0^b\left\{\left[
\frac{4}{ab}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty\frac{\sin\left({p_n x}\right)
\sin\left(q_m y\right)\sin\left(p_n \xi\right)\sin\left(q_m \eta\right)}{p_n^2 + q_m^2}
\right]\right.\times\\\notag
\left.\left[
\frac{4}{ab}\sum_{n'=1}^\infty
                  \sum_{m'=1}^\infty\frac{\sin\left({p_{n'} x'}\right)
\sin\left(q_{m'} y'\right)\sin\left(p_{n'} \xi'\right)\sin\left(q_{m'} \eta'\right)}{p_{n'}^2 + q_{m'}^2}
\right]\right\}\times\\\notag
\exp\left[-\frac{\left(\xi-\xi'\right)^2}{\sigma^2_x}\right]\exp\left[-\frac{\left(\eta-\eta'\right)^2}{\sigma^2_{y}}\right]\dif\xi'\dif\xi\dif\eta'\dif\eta
\end{align}

The above expression can be separated in two different sets of integrals
\begin{align}\notag
\sum_{\forall i}s_{qi}s_{si}\left\{\frac{16}{(ab)^2}\sum_{\forall
  n}\sum_{\forall n'}\sum_{\forall m}\sum_{\forall m'}
\frac{1}{(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}
\sin\left(p_nx\right)
\sin\left(p_{n'}x'\right) \sin\left(q_my\right)
\sin\left(q_{m'}y'\right)\right.\times\\\notag
\left.
\left\{\int_0^a\int_0^a\sin\left(p_n\xi\right)
\sin\left(p_{n'}\xi'\right)\exp\left[-\frac{\left(\xi-\xi'\right)^2}{\sigma^2_x}\right]\dif\xi'\dif\xi\right\}
\left\{\int_0^b\int_0^b\sin\left(q_m \eta\right)
\sin\left(q_{m'}\eta'\right)\exp\left[-\frac{\left(\eta-\eta'\right)^2}{\sigma^2_y}\right]\dif\eta'\dif\eta\right\}\right\}.
\end{align}
In this sense, we have
\begin{align}\notag
\cov\left[v_q(x,y),v_s(x',y')\right]=
\sum_{\forall i}s_{qi}s_{si}\left\{\frac{16}{(ab)^2}\sum_{\forall
  n}\sum_{\forall n'}\sum_{\forall m}\sum_{\forall m'}
\frac{C^x_{v_q,v_s}(n,n') \sin\left(p_nx\right)
\sin\left(p_{n'}x'\right) C^y_{v_q,v_s}(m,m') \sin\left(q_my\right)
\sin\left(q_{m'}y'\right)}{(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}
\right\}
\end{align}
for which
\begin{align}
C^x_{v_q,v_s}(n,n')&=\int_0^a\int_0^a\sin\left(p_n\xi\right)
\sin\left(p_{n'}\xi'\right)\exp\left[-\frac{\left(\xi-\xi'\right)^2}{\sigma^2_x}\right]\dif\xi'\dif\xi\label{eq:Cvvnnp}\\
C^y_{v_q,v_s}(m,m')&=\int_0^b\int_0^b\sin\left(q_m\eta\right)
\sin\left(q_{m'}\eta'\right)\exp\left[-\frac{\left(\eta-\eta'\right)^2}{\sigma^2_y}\right]\dif\eta'\dif\eta.
\end{align}
The expressions above follow an expression that has already been obtained for
the solution of the Heat equation in one space variable. See
\cite{Alvarez:HeatEquationReport} for details. In that case, the one
space Heat equation involves the solution of the following double
integral

\begin{align}\notag
C_{y_q,y_s}(n,m)&=\int_0^l\int_0^l\sin\left(w_n\xi\right)
\sin\left(w_m\xi'\right)\exp\left[-\frac{\left(\xi-\xi'\right)^2}{\sigma^2_x}\right]\dif\xi'\dif\xi,
\end{align}
where $l$ is the spatial length, $w_n= \frac{n\pi}{l}$,
$w_m=\frac{m\pi}{l}$, and $\sigma_x$ is the lenght-scale for the SE
kernel assumed for the latent function.

It can be shown \cite{Alvarez:HeatEquationReport} that the solution
for $C_{y_q,y_s}(n,m)$ follows as
\begin{align}\label{eq:Cyqys_nm}
 C_{y_q,y_s}(n,m)&=
\begin{cases}
\begin{aligned}
\left(\frac{\sigma_x
l}{\sqrt{\pi}(m^2-n^2)}\right)\left\{ne^{\left(\frac{\gamma_m\sigma_x}{2}\right)^2}\mathcal{I}\left[\mathcal{H}
(\gamma_m,l)\right]-\;me^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\mathcal{I}\left[\mathcal{H}(\gamma_n,l)\right]\right\}
\end{aligned}  & \mbox{if }n\mbox{ and }m\mbox{ are both even or both odd}\\
0&\mbox{otherwise}
\end{cases}
\end{align}
for $n\neq m$, where $\gamma_n=j w_n$, $\gamma_m=j w_m$, and  
\begin{align}
\notag \mathcal{H}(\zeta,\upsilon)&=\erf\left(\frac{\upsilon}{\sigma}+\frac{\sigma \zeta}{2}\right)-\erf\left(\frac{\sigma \zeta}{2}\right).
%
\end{align}
If $n=m$, the following expression must be used instead
\begin{align*}
C_{y_q,y_s}(n)
&=\frac{\sigma_x\sqrt{\pi}\,l}{2}e^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\left\{\mathcal{R}\left[\mathcal{H}(\gamma_n,l)\right]
-\mathcal{I}\left[\mathcal{H}(\gamma_n,l)\right]\left[\frac{\sigma_x^2n\pi}{2l^2}+\frac{1}{n\pi}\right]\right\}
+\frac{\sigma^2_x}{2}\left[e^{-(\frac{l}{\sigma_x})^2}\cos(n\pi)-1\right]
\end{align*}

In the expression for $C_{y_q,y_s}(n,n')$, the term
$e^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\mathcal{I}\left[\mathcal{H}
(\gamma_n,l)\right]$ can be replaced for a more numerical stable expression given in terms
of the complex error function $w(z)$,

\begin{align}
\notag
e^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\mathcal{I}\left[\mathcal{H}(\gamma_n,l)\right]&= 
\mathcal{I}\left[w(jz_1^{\gamma_n})-e^{-\left(\frac{l}{\sigma_x}\right)^2}e^{-\gamma_nl}w(jz_2^{\gamma_n})\right],
\end{align}
with $z_1^{\gamma_n}=\frac{\sigma_x\gamma_n}{2}$ and $z_2^{\gamma_n}=\frac{l}{\sigma_x}+\frac{\sigma_x\gamma_n}{2}$. A similar expression for $e^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\mathcal{R}\left[\mathcal{H}
(\gamma_n,l)\right]$ can be obtained when $n=m$.

Derivative for $C_{y_q,y_s}(n,m)$ in terms of $\sigma_x$ can be found
in \cite{Alvarez:HeatEquationReport}.

\subsection*{Gaussian processes over the boundary conditions}

We assume that the boundary functions $f_1(y)$, $f_2(y)$, $f_3(x)$, and $f_4(x)$ are
independent Gaussian processes with SE covariance function. This means that the
covariance for $\cov\left[v_q(x,y),v_s(x',y')\right]$ has additional terms that follow as
  \begin{align*}
    \cov\left[v^{\text{BC}}_q(x,y),v^{\text{BC}}_s(x',y')\right] & =
    \int_0^b\int_0^bH_1(x, y, \eta)H_1(x', y', \eta')K_{f_1}(\eta, \eta')\dif\eta'
    \dif\eta\\
    &+ \int_0^b\int_0^bH_2(x, y, \eta)H_2(x', y', \eta')K_{f_2}(\eta, \eta')\dif\eta'\dif\eta\\
    & + \int_0^a\int_0^aH_3(x, y, \xi)H_3(x', y', \xi')K_{f_3}(\xi, \xi')\dif\xi'
    \dif\xi\\
    &+\int_0^a\int_0^aH_4(x, y, \xi)H_4(x', y', \xi')K_{f_4}(\xi, \xi')\dif\xi'\dif\xi.
  \end{align*}  
For the first covariance, we have
\begin{align*}   
  &  \int_0^b\int_0^bH_1(x, y, \eta)H_1(x', y', \eta')K_{f_1}(\eta, \eta')\dif\eta'
    \dif\eta  = \frac{16}{(ab)^2}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty \sum_{n'=1}^\infty
                  \sum_{m'=1}^\infty\frac{p_n p_{n'}}{(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}
                  \times \\
  & \sin\left({p_n x}\right) \sin\left(q_m y\right)\sin\left({p_{n'} x'}\right)
                  \sin\left(q_{m'} y'\right)\int_0^b\int_0^b
                  \sin\left(q_m \eta\right)\sin\left(q_{m'} \eta'\right)
                  \exp\left[-\frac{\left(\eta-\eta'\right)^2}{\sigma^2_{f_1}}\right]\dif\eta'\dif\eta. 
\end{align*}
Leading to
\begin{align*}   
\frac{16}{(ab)^2}\sum_{n=1}^\infty\sum_{m=1}^\infty \sum_{n'=1}^\infty
\sum_{m'=1}^\infty\frac{p_n p_{n'}\sin\left(p_n x\right)\sin\left(p_{n'} x'\right)
      C^{f_1}_{v^{\text{BC}}_q,v^{\text{BC}}_s}(m,m')\sin\left(q_m y\right)\sin\left(q_{m'} y'\right)}
    {(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}.
\end{align*}
Following a similar procedure for the second covariance, we obtain
\begin{align*}   
\frac{16}{(ab)^2}\sum_{n=1}^\infty\sum_{m=1}^\infty \sum_{n'=1}^\infty
\sum_{m'=1}^\infty\frac{p_n \cos(n\pi)p_{n'}\cos(n'\pi)\sin\left(p_n x\right)\sin\left(p_{n'} x'\right)
      C^{f_2}_{v^{\text{BC}}_q,v^{\text{BC}}_s}(m,m')\sin\left(q_m y\right)\sin\left(q_{m'} y'\right)}
    {(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}.
\end{align*}
For the third covariance, it follows
\begin{align*}   
\frac{16}{(ab)^2}\sum_{n=1}^\infty\sum_{m=1}^\infty \sum_{n'=1}^\infty
\sum_{m'=1}^\infty\frac{C^{f_3}_{v^{\text{BC}}_q,v^{\text{BC}}_s}(n,n')\sin\left(p_n x\right)\sin\left(p_{n'} x'\right)
    [q_m q_{m'}]\sin\left(q_m y\right)\sin\left(q_{m'} y'\right)}
    {(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}.
\end{align*}
Finally, for the fourth covariance, we get
\begin{align*}   
\frac{16}{(ab)^2}\sum_{n=1}^\infty\sum_{m=1}^\infty \sum_{n'=1}^\infty
\sum_{m'=1}^\infty\frac{C^{f_4}_{v^{\text{BC}}_q,v^{\text{BC}}_s}(n,n')\sin\left(p_n x\right)\sin\left(p_{n'} x'\right)
      [q_m \cos(m\pi)q_{m'}\cos(m'\pi)]\sin\left(q_m y\right)\sin\left(q_{m'} y'\right)}
    {(p_n^2 + q_m^2)(p_{n'}^2 + q_{m'}^2)}.
\end{align*}


\section{Covariance matrix bewteen the outputs and the latent functions}

The covariance matrix between the outputs $v_q(x,y)$ and the latent
functions  $f_i(x,y)$
is given by
\begin{align}
\cov\left[v_q(x,y),f_i(x',y')\right]=\ex\left[\sum_{\forall
k}s_{qk}\int_0^a\int_0^bf_k(\xi,\tau)G(x, y, \xi, \eta)\dif\xi\dif\eta f_i(x',y')\right]
\end{align}
Then, the covariance $\cov\left[v_q(x,y),f_i(x',y')\right]$ is given
as
\begin{align}\notag
\sum_{\forall k}s_{qk}\int_0^a\int_0^bG(x,y, \xi,\eta)\ex\left[f_k(\xi,\eta)f_i(x',y')\right]
\dif\xi\dif\eta
\end{align}
Using the factorized form for the covariance of the latent functions, the last expression can be written as
\begin{align}\notag
s_{qi}\int_0^a\int_0^bG(x,y, \xi,\eta)K_i(\xi,x')K_i(\eta,y')
\dif\xi\dif\eta
\end{align}
With the expression \eqref{eq:green:function} for $G(x, y, \xi,\eta)$ and SE kernels for the
covariances of the latent processes, we have
\begin{align}\notag
\begin{split}
s_{qi}\int_0^a\int_0^b&\left\{\left[
\frac{4}{ab}\sum_{n=1}^\infty
                  \sum_{m=1}^\infty\frac{\sin\left({p_n x}\right)
\sin\left(q_m y\right)\sin\left(p_n \xi\right)\sin\left(q_m \eta\right)}{p_n^2 + q_m^2}\right]
\exp\left[-\frac{\left(\xi-x'\right)^2}{\sigma^2_x}\right]\exp\left[-\frac{\left(\eta-y'\right)^2}{\sigma^2_y}\right]\right\}\dif\xi\dif\eta
\end{split}
\end{align}
Again the above expression can be separated in
two different sets of integrals
\begin{align}\notag
\frac{4s_{qi}}{ab} \sum_{\forall n}\sum_{\forall m} \frac{\sin\left({p_n x}\right)
\sin\left(q_m y\right)}{p_n^2 + q_m^2}
\left\{\int_0^a\sin\left(p_n\xi\right)
\exp\left[-\frac{\left(\xi-x'\right)^2}{\sigma^2_x}\right]\dif\xi\right\}
\left\{\int_0^b\sin\left(q_m\eta\right)
\exp\left[-\frac{\left(\eta-y'\right)^2}{\sigma^2_y}\right]\dif\eta\right\}
\end{align}
We have
\begin{align}\notag
\cov\left[v_q(x,y),f_i(x',y')\right]=\frac{4s_{qi}}{ab}
\sum_{\forall n}\sum_{\forall m} \frac{\sin\left({p_n x}\right) C^x_{v_q,f_i}(x',n)
\sin\left(q_m y\right) C^y_{v_q,f_i}(y',m)}{p_n^2 + q_m^2}
\end{align}
in which
\begin{align}\notag
C^x_{v_q,f_i}(x',n) &= \int_0^a\sin\left(p_n\xi\right)
\exp\left[-\frac{\left(\xi-x'\right)^2}{\sigma^2_x}\right]\dif\xi\\\notag
C^y_{v_q,f_i}(y',n) &= \int_0^b\sin\left(q_m\eta\right)
\exp\left[-\frac{\left(\eta-y'\right)^2}{\sigma^2_y}\right]\dif\eta.
\end{align}
A similar expression to the ones above was obtained when solving the
covariance between the output of the Heat equation and the input
function. See \cite{Alvarez:HeatEquationReport}. That expression is
given as
\begin{align}
C_{y_q,f_i}(x',n)&=\int_0^l\sin\left(w_n\xi\right)
\exp\left[-\frac{\left(\xi-x'\right)^2}{\sigma^2_x}\right]\dif\xi.\notag
\end{align}
Its solution follows as
\begin{align}
C_{y_q,f_i}(x',n)&=\frac{\sigma_x\sqrt{\pi}}{2}\exp\left(\frac{\gamma_n\sigma_x}{2}\right)^2\mathcal{I}\left[\exp\left(\gamma_nx'\right)\mathcal{H}(\gamma_n,x',l)\right],\notag
\end{align}
where
\begin{align}
\notag \mathcal{H}(\zeta,\upsilon,\varphi)&=\erf\left(\frac{\upsilon}{\sigma}+\frac{\sigma \zeta}{2}\right)-\erf\left(\frac{\upsilon-\varphi}{\sigma}+\frac{\sigma \zeta}{2}\right).
\end{align}

In the expression for $C_{y_q,f_i}(x',n)$, the term
$\exp\left(\frac{\gamma_n\sigma_x}{2}\right)^2\mathcal{I}\left[\exp\left(\gamma_nx'\right)\mathcal{H}(\gamma_n,x',l)\right]$
can be replaced for a more numerical stable expression given in terms
of the complex error function $w(z)$,
\begin{align}
\notag
e^{\left(\frac{\gamma_n\sigma_x}{2}\right)^2}\mathcal{I}\left[e^{\gamma_nx'}\mathcal{H}(\gamma_n,x',l)\right]
&=\mathcal{I}\left[e^{-\left(\frac{x'-l}{\sigma_x}\right)^2}e^{\gamma_nl}w(jz_2^{\gamma_n,x'})-e^{-\left(\frac{x'}{\sigma_x}\right)^2}
w(jz_1^{\gamma_n,x'})\right],
\end{align}
with $z_1^{\gamma_n,x'}=\frac{x'}{\sigma_x}+\frac{\sigma_x \gamma_n}{2}$ and $z_2^{\gamma_n,x'}=\frac{x'-l}{\sigma_x}
+\frac{\sigma_x\gamma_n}{2}$.

The derivative for $C_{y_q,f_i}(x',n)$ in terms of $\sigma_x$ can also
be found in \cite{Alvarez:HeatEquationReport}.

\small{
\bibliographystyle{unsrt}
\bibliography{pdebib}}
\end{document}
